REM SPACE AILEN GAME
REM  for MachiKania type P
REM   Programmed by KENKEN

WIDTH 40,2
GOSUB INIT1
WHILE 1
 GOSUB INITGM
 DO
  GOSUB NXTSTG
  DO
   WAIT 1
   GOSUB CLCHAR
   GOSUB BUTTON
   GOSUB FIRE
   GOSUB MVCANN
   GOSUB MVALIN
   GOSUB MVUFO
   GOSUB MVMISL
   GOSUB CKCLSN
   GOSUB PTMISL
   GOSUB PTALIN
   GOSUB PTUFO
   GOSUB PTCANN
   GOSUB PTSCOR
   S=GOSUB(CKGAME)
  LOOP WHILE S=0
 LOOP WHILE S=1
 GOSUB GAMEOV
WEND
END

REM FIRST TIME INIT
LABEL INIT1
USEPCG
USEGRAPHIC
GOSUB SETPCG
DIM V(10,4),X(1),Y(1)
H=0
RETURN

REM INIT FOR EVERY GAME
LABEL INITGM
GPRINT 40,80,7,0,"SPACE ALIEN"
GPRINT 24,110,7,0,"PUSH START BUTTON"
WHILE KEYS(16)=0:WAIT 1:P=RND():WEND
P=0:R=0:L=3
GCLS
RETURN

REM INIT FOR NEXT STAGE
LABEL NXTSTG
VAR I,X,S$
P=P+1
IF P>=2 THEN
 GPRINT 30,60,6,0,"CONGRATULATIONS!"
 WAIT 60
 GPRINT 50,85,6,0,"NEXT STAGE":WAIT 120
ENDIF
GCLS
S$=DEC$(P)
GPRINT 216,0,6,0,"SPACE"
GPRINT 216,8,6,0,"ALIEN"
GPRINT 216,48,7,0,"HIGH-"
GPRINT 216,56,7,0,"SCORE"
GPRINT 216,104,7,0,"SCORE"
GPRINT 216,152,7,0,"STAGE"
GPRINT (32-LEN(S$))*8,168,7,0,S$
GOSUB PTSCOR
GPRINT 216,200,5,0,"\XA0\XA1"
GPRINT 248,200,7,0,DEC$(L)
FOR I=0 TO 10:V(I,0)=3:NEXT
FOR I=0 TO 10:V(I,1)=2:NEXT
FOR I=0 TO 10:V(I,2)=2:NEXT
FOR I=0 TO 10:V(I,3)=1:NEXT
FOR I=0 TO 10:V(I,4)=1:NEXT
BOXFILL 0,206,215,207,2
X=21
FOR I=1 TO 4
GPRINT X,160,2,0,"\XF0\XF1\XF2"
GPRINT X,168,2,0,"\XF3\XF4\XF5"
X=X+48
NEXT
GPRINT 60,100,4,0,"STAGE "
GPRINT ,4,0,S$
WAIT 180
BOXFILL 60,100,150,107,0
E=16:F=((P-1)%8)*8+32:D=2
W=8:A=-1:Q=0:N=1:M=0:B=0:T=0
G=0:U=55:Y(0)=0:Y(1)=0:Z=50
K=KEYS()
RETURN

REM GAMEOVER
LABEL GAMEOV
GPRINT 50,130,4,0,"GAME OVER"
WAIT 240
RETURN

REM ERASE CHARACTERS
LABEL CLCHAR
IF B>0 THEN
 BOXFILL C,B,C+1,B+3,0
ELSEIF B=-1 THEN
 BOXFILL C-3,0,C+4,7,0
ENDIF
IF Y(0)>0 THEN
 BOXFILL X(0),Y(0),X(0)+1,Y(0)+3,0
ELSEIF Y(0)=-1 THEN
 BOXFILL X(0)-2,198,X(0)+3,205,0:Y(0)=0
ENDIF
IF Y(1)>0 THEN
 BOXFILL X(1),Y(1),X(1)+1,Y(1)+3,0
ELSEIF Y(1)=-1 THEN
 BOXFILL X(1)-2,198,X(1)+3,205,0:Y(1)=0
ENDIF
RETURN

REM READ BUTTONS
LABEL BUTTON
J=K
K=KEYS()
I=(J XOR 63) AND K
RETURN

REM FIRE MISSILE
LABEL FIRE
VAR P,Q
IF M>0 THEN RETURN
IF B=0 AND (I AND 32)!=0 THEN

 P=RND()
 B=180:C=W+8
 SOUND SOUND1
ENDIF
IF Z>0 THEN Z=Z-1
IF Z=0 AND (Y(0)=0 OR Y(1)=0) THEN
 P=RND()%11
 Q=4
 WHILE Q>=0
  IF V(P,Q)>0 THEN BREAK
  Q=Q-1
 WEND
 IF Q<0 OR F+Q*16>=176 THEN RETURN
 IF Y(0)=0 THEN
  X(0)=E+P*16+7
  Y(0)=F+Q*16+8
 ELSE
  X(1)=E+P*16+7
  Y(1)=F+Q*16+8
 ENDIF
 Z=50
ENDIF
RETURN

REM MOVE CANNON
LABEL MVCANN
IF M>0 THEN
 M=M-1
 IF M=0 THEN
  GPRINT 248,200,7,0,DEC$(L)
  BOXFILL W,184,W+15,191,0
  W=8
 ENDIF
 RETURN
ENDIF
IF W>0 AND (K AND 12)=4 THEN W=W-1
IF W<192 AND (K AND 12)=8 THEN W=W+1
RETURN

REM MOVE ALIEN
LABEL MVALIN
VAR A,I,S
IF M>0 THEN RETURN
G=G+1
IF (U>=20 AND G<20) OR (U>=12 AND G<10) OR (U>=6 AND G<6) OR (U>=3 AND G<2) OR G<1 THEN RETURN
G=0
E=E+D:S=0:T=1-T
IF D>0 AND E>32 THEN
 A=12-E/16
 FOR I=0 TO 4:S=S+V(A,I):NEXT
 IF S>0 THEN E=E-D:F=F+8:D=-D
ELSEIF E<0 THEN
 A=-E/16
 FOR I=0 TO 4:S=S+V(A,I):NEXT
 IF S>0 THEN E=E-D:F=F+8:D=-D
ENDIF
IF S>0 THEN
 GOSUB CLRAL,E,F-8
ENDIF
RETURN

REM MOVE UFO
LABEL MVUFO
Q=Q+1
IF A>=0 THEN
 IF Q>0 AND (Q AND 1)=0 THEN A=A+N
 IF Q=6 THEN Q=0:IF M=0 THEN SOUND SOUND3
 IF A<0 OR A>184 OR Q=-1 THEN
  BOXFILL A,8,A+23,15,0
  A=-1
  N=-N
  Q=0
 ENDIF
ELSE
 IF Q>=1500 AND U>7 THEN
  Q=0
  IF N>0 THEN A=0 ELSE A=184
  SOUND SOUND3
 ENDIF
ENDIF
RETURN

REM MOVE MISSILE
LABEL MVMISL
IF B>0 THEN
 B=B-4
 IF B<=0 THEN B=-3
ELSEIF B<0 THEN
 B=B+1
ENDIF
IF Y(0) THEN
 Y(0)=Y(0)+1
 IF Y(0)>=200 THEN Y(0)=-3
ENDIF
IF Y(1) THEN
 Y(1)=Y(1)+1
 IF Y(1)>=200 THEN Y(1)=-3
ENDIF
RETURN

REM COLISION CHECK
LABEL CKCLSN
VAR S,I,J

REM CHECK MISSILE AND ALIENS
IF B>0 THEN GOSUB CKHIT

REM CHECK MISSILE AND UFO
IF B>=8 AND B<16 AND A>=0 AND Q>=0 THEN
 IF C>=A+4 AND C<A+19 THEN
  B=0
  SOUND SOUND2
  Q=-25
  O=((RND() AND 3)+2)*50
  IF O=250 THEN O=300
  GOSUB ADDSCR,O
 ENDIF
ENDIF

REM CHECK MISSILE AND MISSILE
IF B>0 THEN
 IF C=X(0) AND B>=Y(0) AND B<Y(0)+4 THEN B=0:Y(0)=0:SOUND SOUND2
 IF C=X(1) AND B>=Y(1) AND B<Y(1)+4 THEN B=0:Y(1)=0:SOUND SOUND2
ENDIF

REM CHECK CANNON AND MISSILE
IF M=0 THEN
 IF Y(0)>181 AND Y(0)<192 AND X(0)>=W+2 AND X(0)<=W+14 THEN
  M=120
  SOUND SOUND5
 ELSEIF Y(1)>181 AND Y(1)<192 AND X(1)>=W+2 AND X(1)<=W+14 THEN
  M=120
  SOUND SOUND5
 ENDIF
ENDIF

REM CHECK MISSILE AND SHIELD
IF B>=160 THEN
 S=GCOLOR(C,B)+GCOLOR(C,B+1)+GCOLOR(C,B+2)+GCOLOR(C,B+3)
 IF S THEN BOXFILL C-1,B,C+1,B+3,0:B=0
ENDIF
IF Y(0)>=160 THEN
 I=X(0):J=Y(0)
 S=GCOLOR(I,J)+GCOLOR(I,J+1)+GCOLOR(I,J+2)+GCOLOR(I,J+3)
 IF S THEN Y(0)=0:BOXFILL I-1,J-1,I+2,J+5,0
ENDIF
IF Y(1)>=160 THEN
 I=X(1):J=Y(1)
 S=GCOLOR(I,J)+GCOLOR(I,J+1)+GCOLOR(I,J+2)+GCOLOR(I,J+3)
 IF S THEN Y(1)=0:BOXFILL I-1,J-1,I+2,J+5,0
ENDIF

RETURN

REM CHECK MISSILE HIT ALIEN
LABEL CKHIT
VAR X,Y
IF C<E THEN RETURN
IF C>=E+176 THEN RETURN
IF B<F THEN RETURN
IF B>=F+72 THEN RETURN
X=(C-E)/16:Y=(B-F)/16
IF (E+X*16+ 2)>C THEN RETURN
IF (E+X*16+13)<C THEN RETURN
IF (F+Y*16   )>B THEN RETURN
IF (F+Y*16+15)<B THEN RETURN
IF V(X,Y)<=0 THEN RETURN
IF M=0 THEN SOUND SOUND2
GOSUB ADDSCR,V(X,Y)*10
V(X,Y)=-4:U=U-1:G=-3:B=0
RETURN

REM DRAW ALIENS
LABEL PTALIN
VAR X,Y,I,J,W,N
X=E:Y=F
FOR J=0 TO 4
W=X
FOR I=0 TO 10
N=V(I,J)
IF N THEN GOSUB PALIEN,W,Y,N
IF N<0 THEN V(I,J)=N+1
W=W+16
NEXT
Y=Y+16
NEXT
RETURN

REM DRAW UFO
LABEL PTUFO
IF A<0 THEN RETURN
IF Q>=0 THEN
 GPRINT A,8,3,0,"\XB0\XB1\XB2"
ELSEIF Q=-24 THEN
 GPRINT A,8,3,0,"\XB3\XB4\XB5"
 SOUND SOUND2
ELSEIF Q=-18 THEN
 GPRINT A,8,3,0,DEC$(O)
 SOUND SOUND4
ENDIF
RETURN

REM DRAW CANNON
LABEL PTCANN
IF M=0 THEN
 GPRINT W,184,5,0,"\XA0\XA1"
ELSE
 IF (M AND 2) THEN
  GPRINT W,184,2,0,"\XA2\XA3"
 ELSE
  GPRINT W,184,2,0,"\XA4\XA5"
 ENDIF
ENDIF
RETURN

REM DRAW MISSILE
LABEL PTMISL
IF B>0 THEN
 PUTBMP C,B,1,4,BMPMSL
ELSEIF B<=-2 THEN
 GPRINT C-3,0,2,0,"\X90"
ENDIF
IF Y(0)>0 THEN PUTBMP X(0),Y(0),2,4,BMPMS2
IF Y(1)>0 THEN PUTBMP X(1),Y(1),2,4,BMPMS2
IF Y(0)<0 THEN GPRINT X(0)-2,198,2,0,"\X91"
IF Y(1)<0 THEN GPRINT X(1)-2,198,2,0,"\X91"
RETURN

REM DRAW SCORE
LABEL PTSCOR
VAR S$
S$=DEC$(R)
GPRINT (32-LEN(S$))*8,120,7,0,S$
S$=DEC$(H)
GPRINT (32-LEN(S$))*8,72,7,0,S$
RETURN

REM CHECK GAME STATUS
LABEL CKGAME
VAR A,I,S
IF M=120 THEN
 IF L=0 THEN RETURN 2
 L=L-1
ENDIF
IF U=0 THEN RETURN 1
IF F>=120 THEN
 S=0:A=11-(F-8)/16
 FOR I=0 TO 10:S=S+V(I,A):NEXT
 IF S>0 THEN RETURN 2
ENDIF
RETURN 0

REM ERASE ALIEN
LABEL CLRAL
VAR X,Y,I,J,W
X=ARGS(1):Y=ARGS(2)
FOR J=0 TO 4
W=X
FOR I=0 TO 10
IF V(I,J) THEN BOXFILL W,Y,W+15,Y+7,0
W=W+16
NEXT
Y=Y+16
NEXT
RETURN

REM DRAW AN ALIEN
LABEL PALIEN
VAR X,Y,C,N,P
X=ARGS(1):Y=ARGS(2):N=ARGS(3)
IF N=-1 THEN BOXFILL X,Y,X+15,Y+7,0:RETURN
IF G>0 THEN RETURN
IF N<0 THEN
 P=$8C
ELSE
 P=$80+(N-1)*4+T*2
ENDIF
IF Y<8 THEN
 C=2
ELSEIF Y<32 THEN
 C=3
ELSEIF Y<64 THEN
 C=4
ELSEIF Y<96 THEN
 C=5
ELSEIF Y<128 THEN
 C=3
ELSEIF Y<160 THEN
 C=6
ELSE
 C=2
ENDIF
GPRINT X,Y,C,0,CHR$(P)+CHR$(P+1)
RETURN

REM ADD SCORES
LABEL ADDSCR
R=R+ARGS(1)
IF R>=99999 THEN R=99999
IF R>H THEN H=R
RETURN

REM SET CHARACTERS FONTS
LABEL SETPCG
VAR N
RESTORE PCGDAT
WHILE 1
 N=READ()
 IF N=$100 THEN BREAK
 PCG N,READ(),READ()
WEND
RETURN

LABEL PCGDAT
REM ALIEN1
DATA $80,$031F3F39,$3F060D30
DATA $81,$C0F8FC9C,$FC60B00C
DATA $82,$031F3F39,$3F0E190C
DATA $83,$C0F8FC9C,$FC709830

REM ALIEN2
DATA $84,$0812171D,$1F0F0408
DATA $85,$1024F4DC,$FCF81008
DATA $86,$0402070D,$1F171403
DATA $87,$1020F0D8,$FCF41460

REM ALIEN3
DATA $88,$0103070D,$0F02050A
DATA $89,$80C0E0B0,$F040A050
DATA $8A,$0103070D,$0F050804
DATA $8B,$80C0E0B0,$F0A01020

REM ALIEN EXPLODE
DATA $8C,$04221008,$60081224
DATA $8D,$40881020,$0C209048

REM SHOT EXPLODE
DATA $90,$89227EFF,$FF7E2491

REM ALIEN SHOT EXPLODE
DATA $91,$20883478,$BC7CBC54

REM CANNON
DATA $A0,$0001011F,$3F3F3F3F
DATA $A1,$80C0C0FC,$FEFEFEFE

REM CANNON EXPLODE
DATA $A2,$02000212,$01451F3F
DATA $A3,$0010A000,$B0A8E4F5
DATA $A4,$10821002,$4B211F37
DATA $A5,$0419C002,$31C4F0F2

REM UFO
DATA $B0,$00000103,$060F0302
DATA $B1,$007EFFFF,$DBFF9900
DATA $B2,$000080C0,$60F0C080

REM UFO EXPLODE
DATA $B3,$12085103,$07114011
DATA $B4,$8106E3F9,$54F1A310
DATA $B5,$48100088,$E4801080

REM SHIELD
DATA $F0,$0F1F3F7F,$FFFFFFFF
DATA $F1,$FFFFFFFF,$FFFFFFFF
DATA $F2,$C0E0F0F8,$FCFCFCFC
DATA $F3,$FFFFFFFF,$FEFCF8F8
DATA $F4,$FFFFFFFF,$03010000
DATA $F5,$FCFCFCFC,$FCFCFCFC

DATA $100

LABEL BMPMSL
CDATA 6,6,6,6

LABEL BMPMS2
CDATA 5,0,0,5,5,0,0,5

REM SOUND DATA

REM FIRE
LABEL SOUND1
DATA $000A02D0,1

REM AILEN EXPLOSION
LABEL SOUND2
DATA $00020600,$00080300,1

REM UFO MOVING
LABEL SOUND3
DATA $00030680,$00030635,1

REM UFO SCORE
LABEL SOUND4
DATA $00040780,$00020000,3

REM CANNON EXPLOSION
LABEL SOUND5
DATA $00032000,$00010000,20
